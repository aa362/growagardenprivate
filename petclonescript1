local Workspace = game:GetService("Workspace")

-- ソフトブラック（完全黒ではない）
local SOFT_BLACK = Color3.fromRGB(25, 25, 25)

-- アニメ風 2D 煙のテクスチャ ID
local SMOKE_TEXTURE_ID = "rbxassetid://771221224"

-- 2D煙を追加（1つの BasePart にのみ）
local function addCartoonSmoke(part)
	if not part:FindFirstChild("CartoonSmoke") then
		local emitter = Instance.new("ParticleEmitter")
		emitter.Name = "CartoonSmoke"
		emitter.Texture = SMOKE_TEXTURE_ID
		emitter.Rate = 8
		emitter.Lifetime = NumberRange.new(1.2, 1.5)
		emitter.Speed = NumberRange.new(0.5, 1)
		emitter.Size = NumberSequence.new({
			NumberSequenceKeypoint.new(0, 1),
			NumberSequenceKeypoint.new(1, 2)
		})
		emitter.Transparency = NumberSequence.new({
			NumberSequenceKeypoint.new(0, 0.1),
			NumberSequenceKeypoint.new(1, 1)
		})
		emitter.Color = ColorSequence.new(Color3.new(0.5, 0.5, 0.5))
		emitter.LightInfluence = 0
		emitter.RotSpeed = NumberRange.new(-30, 30)
		emitter.Rotation = NumberRange.new(0, 360)
		emitter.LockedToPart = true
		emitter.Parent = part
	end
end

-- モデルに色と煙を適用
local function styleDragonModel(model)
	for _, part in ipairs(model:GetDescendants()) do
		if part:IsA("BasePart") then
			part.Color = SOFT_BLACK
		end
	end

	for _, part in ipairs(model:GetDescendants()) do
		if part:IsA("BasePart") and part.Name:lower():find("head") then
			addCartoonSmoke(part)
			break
		end
	end
end

-- 対象モデル名をチェック
local function isDragonModel(model)
	return model:IsA("Model") and (model.Name == "Red Dragon" or model.Name == "Bella")
end

-- すでにあるモデルにも適用
for _, model in ipairs(Workspace:GetDescendants()) do
	if isDragonModel(model) then
		styleDragonModel(model)
	end
end

-- 新しいモデルが出たときに適用（軽量対応）
Workspace.DescendantAdded:Connect(function(descendant)
	local model = descendant:FindFirstAncestorWhichIsA("Model")
	if model and isDragonModel(model) then
		task.defer(function()
			styleDragonModel(model)
		end)
	end
end)
