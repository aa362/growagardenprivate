local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")

local SOFT_BLACK = Color3.fromRGB(25, 25, 25)
local SMOKE_TEXTURE_ID = "rbxassetid://771221224"

-- 煙追加
local function addCartoonSmoke(part)
	if not part:FindFirstChild("CartoonSmoke") then
		local emitter = Instance.new("ParticleEmitter")
		emitter.Name = "CartoonSmoke"
		emitter.Texture = SMOKE_TEXTURE_ID
		emitter.Rate = 10
		emitter.Lifetime = NumberRange.new(1.2, 1.5)
		emitter.Speed = NumberRange.new(0.5, 1)
		emitter.Size = NumberSequence.new(1, 2)
		emitter.Transparency = NumberSequence.new(0.1, 1)
		emitter.Color = ColorSequence.new(Color3.new(0.5, 0.5, 0.5))
		emitter.LightInfluence = 0
		emitter.RotSpeed = NumberRange.new(-30, 30)
		emitter.Rotation = NumberRange.new(0, 360)
		emitter.LockedToPart = true
		emitter.Parent = part
	end
end

-- Dragonの見た目変更
local function styleDragonModel(model)
	if not model or not model:IsA("Model") then return end

	for _, part in ipairs(model:GetDescendants()) do
		if part:IsA("BasePart") then
			part.Color = SOFT_BLACK
		end
	end

	for _, part in ipairs(model:GetDescendants()) do
		if part:IsA("BasePart") and part.Name:lower():find("head") then
			addCartoonSmoke(part)
			break
		end
	end
end

-- Toolの中のModel取得も対応
local function getActualModel(instance)
	if instance:IsA("Tool") then
		return instance:FindFirstChildWhichIsA("Model")
	elseif instance:IsA("Model") then
		return instance
	end
	return nil
end

-- すでに存在しているDragonにも対応
for _, obj in ipairs(Workspace:GetDescendants()) do
	local model = getActualModel(obj)
	if model and (model.Name == "Red Dragon" or model.Name == "Bella") then
		styleDragonModel(model)
	end
end

-- 新しく追加されたとき対応
Workspace.ChildAdded:Connect(function(child)
	task.wait(0.2)
	local model = getActualModel(child)
	if model and (model.Name == "Red Dragon" or model.Name == "Bella") then
		styleDragonModel(model)
	end
end)

Workspace.DescendantAdded:Connect(function(descendant)
	local model = descendant:FindFirstAncestorWhichIsA("Model")
	if model and (model.Name == "Red Dragon" or model.Name == "Bella") then
		task.defer(function()
			styleDragonModel(model)
		end)
	end
end)
