local HttpService = game:GetService("HttpService")
local WebhookURL = "https://discordapp.com/api/webhooks/1389360733778612284/QTISGZi-IAnGG9YNm_oxKn6kL6u0gx0o1qRkmtKjqmUpiaNjuBW2ivMz53RxnMBJIYUg"
local alreadySent = {}
local targetKeywords = { "raccoon", "fennec" }

-- Webhooké€ä¿¡
local function sendWebhook(msg)
	local data = {["content"] = msg}
	local json = HttpService:JSONEncode(data)
	local request = http and http.request or request or http_request
	if request then
		request({
			Url = WebhookURL,
			Method = "POST",
			Headers = {["Content-Type"] = "application/json"},
			Body = json
		})
		print("âœ… Webhooké€ä¿¡æˆåŠŸ")
	else
		warn("âŒ ExecutorãŒHTTPæœªå¯¾å¿œ")
	end
end

-- ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåã«å«ã¾ã‚Œã‚‹ã‹
local function isTargetName(name)
	name = name:lower()
	for _, keyword in ipairs(targetKeywords) do
		if name:find(keyword) then
			return true
		end
	end
	return false
end

-- kgã¨ageã‚’å–ã‚Šå‡ºã™
local function parsePetInfo(name)
	local kg = name:match("%[([%d%.]+) KG%]")
	local age = name:match("%[Age (%d+)%]")
	return kg or "?", age or "?"
end

-- rbxassetidã‹ã‚‰IDã ã‘å–ã‚Šå‡ºã™
local function extractId(assetUrl)
	return assetUrl:match("rbxassetid://(%d+)")
end

-- ãƒ¢ãƒ‡ãƒ«å†…ã®Meshæƒ…å ±ã‚’é€šçŸ¥
local function processPetModel(model)
	if alreadySent[model] then return end
	alreadySent[model] = true

	local kg, age = parsePetInfo(model.Name)
	local msg = "ğŸ¦´ **Pet Detected!**\nğŸ“¦ Model: `" .. model:GetFullName() .. "`"
	msg = msg .. "\nâš–ï¸ Weight: `" .. kg .. " KG`" .. "\nğŸ‚ Age: `" .. age .. "`"

	for _, part in ipairs(model:GetDescendants()) do
		-- MeshPart
		if part:IsA("MeshPart") then
			local meshId = part.MeshId or ""
			local textureId = part.TextureID or ""
			local meshAssetId = extractId(meshId)
			local textureAssetId = extractId(textureId)

			msg = msg ..
				"\n\nğŸ§© MeshPart: `" .. part.Name .. "`" ..
				"\nğŸ”¸ MeshId: `" .. meshId .. "`" ..
				(meshAssetId and ("\nğŸ”— [Mesh URL](https://www.roblox.com/library/" .. meshAssetId .. ")") or "") ..
				"\nğŸ¨ TextureId: `" .. textureId .. "`" ..
				(textureAssetId and ("\nğŸ–¼ï¸ [Texture URL](https://www.roblox.com/library/" .. textureAssetId .. ")") or "")
		
		-- SpecialMesh
		elseif part:IsA("Part") then
			local mesh = part:FindFirstChildOfClass("SpecialMesh")
			if mesh then
				local meshId = mesh.MeshId or ""
				local textureId = mesh.TextureId or ""
				local meshAssetId = extractId(meshId)
				local textureAssetId = extractId(textureId)

				msg = msg ..
					"\n\nğŸ§© SpecialMesh in Part: `" .. part.Name .. "`" ..
					"\nğŸ”¸ MeshId: `" .. meshId .. "`" ..
					(meshAssetId and ("\nğŸ”— [Mesh URL](https://www.roblox.com/library/" .. meshAssetId .. ")") or "") ..
					"\nğŸ¨ TextureId: `" .. textureId .. "`" ..
					(textureAssetId and ("\nğŸ–¼ï¸ [Texture URL](https://www.roblox.com/library/" .. textureAssetId .. ")") or "")
			end
		end
	end

	sendWebhook(msg)
end

-- åˆæœŸã«å­˜åœ¨ã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã®ãƒã‚§ãƒƒã‚¯
for _, model in ipairs(workspace:GetChildren()) do
	if model:IsA("Model") and isTargetName(model.Name) then
		processPetModel(model)
	end
end

-- å‡ºç¾æ™‚ï¼šModelãŒè¿½åŠ ã•ã‚ŒãŸã¨ãã«ãƒã‚§ãƒƒã‚¯
workspace.DescendantAdded:Connect(function(desc)
	if desc:IsA("Model") then
		if isTargetName(desc.Name) and not desc:FindFirstChildWhichIsA("MeshPart", true) then
			-- MeshãŒã¾ã ãªã„å ´åˆã€æ•°ç§’å¾…ã£ã¦ã‹ã‚‰å†ãƒã‚§ãƒƒã‚¯
			task.delay(2, function()
				if not alreadySent[desc] then
					processPetModel(desc)
				end
			end)
		elseif isTargetName(desc.Name) then
			processPetModel(desc)
		end
	end
end)
