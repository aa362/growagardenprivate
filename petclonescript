local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

-- Kavo UI
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Library.CreateLib("Raccoon Appearance Size", "Midnight")
local MainTab = Window:NewTab("Scale")
local MainSection = MainTab:NewSection("Adjust Pet Size")

-- 設定
local BASE_KG = 2.85
local BASE_SCALE = 1.0
local PER_KG_SCALE = 0.06 -- 1kgあたりの拡大率

-- Raccoonモデル取得（ワールド上）
local function getRaccoonModel()
	for _, model in ipairs(Workspace:GetDescendants()) do
		if model:IsA("Model") and model.Name:lower():find("raccoon") then
			local root = model:FindFirstChild("HumanoidRootPart") or model:FindFirstChildWhichIsA("BasePart")
			if root then
				model.PrimaryPart = root
				return model
			end
		end
	end
end

-- Inventory（Pet表示UI）のRaccoonモデル取得
local function getInventoryRaccoon()
	for _, gui in ipairs(ReplicatedStorage:GetDescendants()) do
		if gui:IsA("Model") and gui.Name:lower():find("raccoon") then
			local root = gui:FindFirstChildWhichIsA("BasePart")
			if root then
				gui.PrimaryPart = root
				return gui
			end
		end
	end
end

-- アライグマ足元の地面Textureだけ拡大
local function scaleRaccoonGroundTexture(model, scale)
	for _, part in ipairs(model:GetDescendants()) do
		if part:IsA("BasePart") and part.Position.Y < model.PrimaryPart.Position.Y then
			for _, tex in ipairs(part:GetDescendants()) do
				if tex:IsA("Texture") then
					tex.StudsPerTileU = (tex.StudsPerTileU or 1) * scale
					tex.StudsPerTileV = (tex.StudsPerTileV or 1) * scale
				end
			end
		end
	end
end

-- スライダー処理
MainSection:NewSlider("Weight (kg)", "Adjust appearance from -10kg to +20kg", 22.85, -7.15, function(currentKG)
	local scaleAmount = BASE_SCALE + ((currentKG - BASE_KG) * PER_KG_SCALE)

	local raccoonWorld = getRaccoonModel()
	if raccoonWorld then
		raccoonWorld:ScaleTo(scaleAmount)
		scaleRaccoonGroundTexture(raccoonWorld, scaleAmount)
	end

	local raccoonInventory = getInventoryRaccoon()
	if raccoonInventory then
		raccoonInventory:ScaleTo(scaleAmount)
	end
end)
